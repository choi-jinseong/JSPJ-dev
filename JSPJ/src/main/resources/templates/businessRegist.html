<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Welcome</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: #f6f7fb;
        }
        
        header {
            background: #f2f7f8;
            color: #333;
            padding: 15px 20px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .top_menu {
            display: flex;
            align-items: center;
            gap: 50px;
        }

        .top_menu a {
            text-decoration: none;
            color: #4a6cf7;
            font-weight: 500;
            transition: 0.2s;
        }

        .top_menu a:hover {
            color: #1a40d1;
        }

		
		.approve-btn {
		            background: white;
		            color: #4a6cf7;
		            padding: 8px 16px;
		            border-radius: 8px;
		            font-size: 16px;
		            font-weight: bold;
		            border: solid;
		            cursor: pointer;
		            transition: 0.2s ease-in-out;
		        }
				
		.reject-btn {
		            background: white;
		            color: red;
		            padding: 8px 16px;
		            border-radius: 8px;
		            font-size: 16px;
		            font-weight: bold;
		            border: solid;
		            cursor: pointer;
		            transition: 0.2s ease-in-out;
		        }
        
		/* 상품등록 버튼 */
        .regist-btn {
            background: white;
            color: #4a6cf7;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            border: solid;
            cursor: pointer;
            transition: 0.2s ease-in-out;
        }
        
        /* 업체 찾기 팝업 버튼 */
        .selComp-btn {
            background: white;
            color: #4a6cf7;
            padding: 3px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            border: solid;
            cursor: pointer;
            transition: 0.2s ease-in-out;
        }
        
        /* 담당자 찾기 팝업 버튼 */
        .selManage-btn {
            background: white;
            color: #4a6cf7;
            padding: 3px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            border: solid;
            cursor: pointer;
            transition: 0.2s ease-in-out;
        }
        
        /* 임시저장 버튼 */
        .tempRegist-btn{
         	background: white;
            color: black;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            border: solid;
            cursor: pointer;
            transition: 0.2s ease-in-out;
        }
        
        
        /* 중복검사 버튼 */
        .idChk-btn {
		    padding: 8px 12px;
		    border-radius: 6px;
		    background: #4a6cf7;
		    color: white;
		    border: none;
		    cursor: pointer;
		    white-space: nowrap;  /* 버튼 줄바꿈 금지 */
		    height: 36px;         /* input과 동일 높이 */
		    display: flex;
		    align-items: center;
		    justify-content: center;
		    font-size: 14px;
		    transition: 0.2s;
		}

        .regist-btn:hover {
            background: #e2e8ff; /* 연한 파란색 */
        }

        /* 콘텐츠 */
		.content {
		    max-width: none;      /* 제한 없앰 */
		    margin: 30px 0;       /* 위/아래 여백만 줌 */
		    background: white;
		    padding: 20px;        /* 내부 여백 */
		    border-radius: 12px;
		    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
		    text-align: left;     /* 왼쪽 정렬 */
		}

        .content h2 {
            margin-bottom: 20px;
            color: #333;
        }

		.registArea {
		    max-width: none;
		    margin: 0 auto;
		    padding: 20px;
		    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
		    border-radius: 12px;
		    background: #fff;
		}
        
		.registChkArea {
		    max-width: none;
		    margin: 0 auto;
		    padding: 20px;
		    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
		    border-radius: 12px;
		    background: #fff;
		}
        
        
        /* 푸터 */
        footer {
            margin-top: 40px;
            background: #eee;
            padding: 10px;
            text-align: center;
            color: #555;
            font-size: 14px;
        }
        
        
        /* 셀렉트 박스 공통 스타일 */
		select {
		    width: 150px;
		    padding: 8px;
		    border-radius: 6px;
		    border: 1px solid #ccc;
		    background: white;
		    font-size: 14px;
		    transition: 0.2s ease-in-out;
		    cursor: pointer;
		}
		
		/* hover 시 부드럽게 */
		select:hover {
		    border-color: #4a6cf7;
		    background: #f0f4ff;
		}
		
		/* 포커스 시 */
		select:focus {
		    outline: none;
		    border-color: #4a6cf7;
		    box-shadow: 0 0 5px rgba(74,108,247,0.4);
		}

		/* textarea를 감싸는 form-row도 내용에 맞춰 늘어나도록 */
		.form-row {
		    display: flex;
		    justify-content: flex-start;
		    align-items: flex-start; /* 세로 정렬 flex-start로 변경 */
		    flex-wrap: wrap;
		    gap: 20px;
		    margin-top: 20px;
		}
		
		/* 상품 설명 form-row 별도로 세로 방향으로 */
		.form-row.textarea-row {
		    flex-direction: column; /* 세로 방향 */
		    align-items: stretch;   /* 부모 너비에 맞춰 늘어나도록 */
		}
		
		/* form-group 너비 최대 45%에서 48% 정도로 늘리고, flex-grow 사용 */
		.form-group {
		    flex: 1 1 48%;  /* 기본 너비 48%, 필요시 늘어나도록 */
		    display: flex;
		    align-items: center;
		}
		
		/* label 폭 조절 */
		.form-group label {
		    width: 120px; 
		    margin-right: 10px;
		    font-weight: bold;
		    text-align: right;
		}
		
		/* textarea와 file input 가로폭 꽉 */
		.form-row textarea,
		.form-row input[type="text"],
		.form-row input[type="number"],
		.form-row select,
		.form-row input[type="file"] {
		    flex: 1;
		     padding: 8px;
		    border-radius: 6px;
		    border: 1px solid #ccc;
		    min-width: 0; /* flex-box에서 overflow 방지 */
		}
		
		/* 이미지 미리보기 */
		#imagePreview img {
		    max-width: 200px;
		    max-height: 200px;
		    border: 1px solid #ccc;
		    border-radius: 6px;
		    margin-top: 10px;
		}
		
		/* textarea 높이 늘리고 내용에 맞춰 늘어나도록 */
		textarea {
		    width: 100%;
		    min-height: 150px;     /* 초기 높이 */
		    max-height: none;      /* 최대 높이 제한 없음 */
		    padding: 8px;
		    border-radius: 6px;
		    border: 1px solid #ccc;
		    overflow-y: auto;      /* 내용 넘치면 스크롤 */
		    resize: vertical;      /* 사용자가 세로로 조절 가능 */
		    box-sizing: border-box;
		}
				
		
    </style>
</head>

<body>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
	$(document).ready(function() {
		 // 이미지 미리보기 및 기존 이미지 교체
	    $('#productImage').on('change', function (event) {
	        const file = event.target.files[0];

	        if (!file) return;

	        // 이미지 파일 체크
	        if (!file.type.startsWith('image/')) {
	            alert('이미지 파일만 업로드 가능합니다.');
	            $(this).val('');
	            return;
	        }

	        const reader = new FileReader();
	        reader.onload = function (e) {
	            // 기존 이미지 제거 후 새 이미지 보여주기
	            $('#imagePreview').html(`<img src="${e.target.result}" alt="미리보기 이미지" 
	                                     style="max-width:200px; max-height:200px; border:1px solid #ccc; border-radius:6px;">`);
	        };
	        reader.readAsDataURL(file);
	    });
	});

	// 업체 담당자 검색 팝업 
	function openManagerPopup(){
	    window.open(
	        '/popup/manager', 
	        'managerPopup', 
	        'width=850,height=500,scrollbars=yes'
	    );
	}

	// 업체 검색 팝업
	function openCompanyPopup(){
	    window.open(
	        '/popup/company', 
	        'companyPopup', 
	        'width=850,height=500,scrollbars=yes'
	    );
	}
	
	//상품등록
 	function productRegist(){
 	   
 	   if( $('#companyName').val() == "" || $('#companyName').val() == null){
 		   alert("회사명을 입력해주세요");
 		   return;
 	   }
 	   
 	   if( $('#managerName').val() == "" || $('#managerName').val() == null){
 		   alert("담당자명을 입력해주세요");
 		   return;
 	   }
 	   
 	   if( $('#productName').val() == "" || $('#productName').val() == null){
 		   alert("상품이름을 입력해주세요");
 		   return;
 	   }
 	   
 	   if( $('#productPrice').val() == "" || $('#productPrice').val() == null){
 		   alert("상품의 가격을 입력해주세요");
 		   return;
 	   }
 	   if( $('#productCnt').val() == "" || $('#productCnt').val() == null){
 		   alert("상품수량을 입력해주세요");
 		   return;
 	   }
 	   if( $('#productCategory').val() == "" || $('#productCategory').val() == null){
 		   alert("상품의 카테고리를 입력해주세요");
 		   return;
 	   }
 	   
 	   
 	 	const formData = new FormData();
 		 // input 값 가져오기
 	    formData.append("registId", $('#registId').val());
 	    formData.append("companyNm", $('#companyName').val());
 	    formData.append("companyCd", $('#companyCd').val());
    	formData.append("managerNm", $('#managerName').val());
    	formData.append("managerId", $('#managerId').val());
    	formData.append("productNm", $('#productName').val());
    	formData.append("price", $('#productPrice').val());
    	formData.append("productCnt", $('#productCnt').val());
    	formData.append("productCategory", $('#productCategory').val());
    	formData.append("productDesc", $('#productDesc').val());
    	formData.append("state", "A");
 	    
    	const file = $('#productImage')[0].files[0];
        if (file) {
            formData.append("productImage", file);
        }
 	    
 	    $.ajax({
 	        url: '/insProductRegist',          
 	        type: 'POST',
 	        data: formData,
 	        processData: false,
 	        contentType: false,
 	        success: function(data) {
 	            if(data == "success"){
 	                alert('상품이 정상적으로 등록되었습니다.');
 	                location.href="/"; 
 	            } else {
 	                alert('상품등록 실패 ');
 	            }
 	        },
 	        error: function(xhr, status, error) {
 	            console.error('상품등록 중 오류:', error);
 	        }
 	    });
	 
 	}
	
	//임시저장 
	function productTempRegist(){
		
		if($('#state').val() == "A"){
			alert("등록이 완료된건은 임시저장이 불가능합니다");
			return;
		}
		
		var dataInfo = {};
		 // input 값 가져오기
	    var companyNm = $('#companyName').val();
	    var managerNm = $('#managerName').val();
	    var productNm = $('#productName').val();
	    var price = $('#productPrice').val();
	    var productCnt = $('#productCnt').val();
	    var productCategory = $('#productCategory').val();
	    var productDesc = $('#productDesc').val();
		var state = 'Z';
	    
	    dataInfo.companyNm = companyNm;
	    dataInfo.managerNm = managerNm;
	    dataInfo.productNm = productNm;
	    dataInfo.price = price;
	    dataInfo.productCnt = productCnt;
	    dataInfo.productCategory =  productCategory;
	    dataInfo.productDesc =  productDesc;
	    dataInfo.state = state;
	    
	    $.ajax({
	        url: '/insTempProductRegist',          
	        type: 'POST',
	        data: JSON.stringify(dataInfo),
	        contentType: 'application/json',
	        success: function(data) {
	            if(data == "success"){
	                alert('상품이 정상적으로 임시저장 되었습니다.');
	                location.href="/"; 
	            } else {
	                alert('상품 임시저장 실패 ');
	            }
	        },
	        error: function(xhr, status, error) {
	            console.error('상품 임시저장 중 오류:', error);
	        }
	    });
		 
	}
</script>

    <!-- 헤더 -->
    <header>
	     <div>
	        <span class="image main"><img src="/resources/images/pearl/main/jspj.png" alt="" style="width: 133px;"></span>
	    </div>
	    <div class="top_menu">
		    <th:block th:each="item : ${menuList}">
		        <a th:href="${item.menuUrl}" style="color:black;" th:text="${item.title != null ? item.title : 'Untitled'}"></a>
		    </th:block>
		</div>
    </header>

    <!-- 메인 콘텐츠 -->
	 <div class="content">
	    <h2>상품등록</h2>
	
		<!-- 상품등록 영역  일반사용자 화면 -->
		<div class="registArea">
		    <!-- 1번째 줄 : 상품명 / 가격 -->
		    <div class="form-row">	
				<input type="hidden" id="state" name="state" th:value="${regProductVo?.state}">
				<input type="hidden" id="registId" name="registId" th:value="${regProductVo?.registId}"> 
		        <div class="form-group">
		            <label for="companyName">회사명</label>
		            <div style="display:flex; gap:10px; width:82%;">
				        <input type="text" id="companyName" name="companyName" placeholder="회사명 입력" readonly th:value="${regProductVo?.companyNm}">
				        <input type="hidden" id="companyCd" name="companyCd" th:value="${regProductVo?.companyCd}">
				        <button type="button" class="selComp-btn" style="height: 35px;" onclick="openCompanyPopup()">찾기</button>
				    </div>
		        </div>
		        <div class="form-group">
		            <label for="managerName">담당자명</label>
		            <div style="display:flex; gap:10px; width:82%;">
				        <input type="text" id="managerName" name="managerName" placeholder="담당자 입력" readonly th:value="${regProductVo?.managerNm}">
				        <input type="hidden" id="managerId" name="managerId" th:value="${regProductVo?.managerId}">
				        <button type="button" class="selManage-btn" style="height: 35px;" onclick="openManagerPopup()">찾기</button>
				    </div>
		        </div>
		    </div>
		    
		    <!-- 2번째 줄 : 상품명 / 가격 -->
		    <div class="form-row">
		        <div class="form-group">
		            <label for="productName">상품명</label>
		            <input type="text" id="productName" name="productName" placeholder="상품명 입력" th:value="${regProductVo?.productNm}">
		        </div>
		        <div class="form-group">
		            <label for="productPrice">가격</label>
		            <input type="number" id="productPrice" name="productPrice" placeholder="가격 입력" th:value="${regProductVo?.price}">
		        </div>
		    </div>
		
		    <!-- 3번째 줄 : 수량 / 카테고리 -->
		    <div class="form-row">
		        <div class="form-group">
		            <label for="productCnt">수량</label>
		            <input type="number" id="productCnt" name="productCnt" placeholder="수량 입력" th:value="${regProductVo?.productCnt}"> 
		        </div>
		        <div class="form-group">
		            <label for="productCategory">카테고리</label>
		           <select id="productCategory" name="productCategory">
					    <option value="">카테고리 선택</option>
					    <option value="electronics" th:selected="${regProductVo != null and regProductVo.productCategory == 'electronics'}">전자제품</option>
					    <option value="clothes" th:selected="${regProductVo != null and regProductVo.productCategory == 'clothes'}">의류</option>
					    <option value="food" th:selected="${regProductVo != null and regProductVo.productCategory == 'food'}">식품</option>
					</select>
		        </div>
		    </div>
		
		    <!-- 4번째 줄 : 상품 설명 -->
			<div class="form-row textarea-row">
			    <label for="productDesc" style="font-weight:bold; margin-bottom:5px;">상품 설명</label>
			    <textarea id="productDesc" name="productDesc"  placeholder="상품 설명 입력"
          			th:text="${regProductVo != null ? regProductVo.productDesc : ''}"></textarea>
			</div>
		
		    <!-- 5번째 줄 : 이미지 업로드 -->
		    <div class="form-row" style="flex-direction: column; align-items: flex-start; margin-top:20px;">
			    <label for="productImage" style="font-weight:bold; margin-bottom:5px;">상품 이미지</label>
			    <input type="file" id="productImage" name="productImage" accept="image/*">
			    
			    <div id="imagePreview" style="margin-top:10px;">
			        <!-- 기존 DB 이미지가 있으면 보여주기 -->
			        <img th:if="${regProductVo != null and regProductVo.filePath != null}" 
			             th:src="@{${regProductVo.filePath}}" 
			             alt="등록된 상품 이미지"
			             style="max-width:200px; max-height:200px; border:1px solid #ccc; border-radius:6px;">
			    </div>
			</div>
		
		
		    <!-- 등록 버튼 -->
		    <div style="margin-top: 30px; text-align:right;" th:if="${auth == 'USER'}">
		    	<button class="tempRegist-btn" onclick="productTempRegist()">임시저장</button>
		        <button class="regist-btn" onclick="productRegist()">상품등록</button>
		    </div>
		    <!-- 반려 승인 버튼 -->
		    <div style="margin-top: 30px; text-align:right;" th:if="${auth == 'ADMIN'}">
		    	<button class="reject-btn" onclick="productReject()">반려</button>
		        <button class="approve-btn" onclick="productApprove()">승인</button>
		    </div>
		</div>
	
</div>

    <!-- 푸터 -->
    <footer>
        © 2025 JSPJ Project. All rights reserved.
    </footer>

</body>
</html>